<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Journal Entry - Analog Music Journal</title>

  <!-- Design tokens from @glitch/tokens -->
  <link rel="stylesheet" href="/node_modules/@glitch/tokens/src/index.css">

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: var(--font-primary);
      min-height: 100vh;
      line-height: var(--leading-relaxed);
    }

    /* ============================================
       COLLAGE LAYOUT
       Elements positioned off-axis with negative space
       ============================================ */

    .journal-page {
      position: relative;
      z-index: 10;
      max-width: 1400px;
      margin: 0 auto;
      padding: var(--space-8);
      min-height: 100vh;
    }

    /* Header - default left-aligned (when first essay is right) */
    .journal-header {
      max-width: 500px;
      margin-left: 5%;
      margin-bottom: 15vh;
      padding-top: 8vh;
    }

    /* Right-aligned header (when first essay is left) */
    .journal-header.header-right {
      margin-left: auto;
      margin-right: 5%;
      text-align: right;
    }

    .journal-header.header-right .journal-tags {
      justify-content: flex-end;
    }

    .journal-date {
      font-size: var(--text-xs);
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-bottom: var(--space-3);
    }

    .journal-title {
      font-size: clamp(var(--text-2xl), 5vw, var(--text-4xl));
      margin: 0;
      color: var(--text-primary);
      font-weight: normal;
      line-height: 1.1;
    }

    .journal-subtitle {
      font-size: var(--text-base);
      color: var(--text-secondary);
      margin-top: var(--space-4);
      font-style: italic;
    }

    .journal-tags {
      display: flex;
      gap: var(--space-2);
      margin-top: var(--space-6);
      flex-wrap: wrap;
    }

    .tag {
      font-size: var(--text-xs);
      padding: var(--space-1) var(--space-3);
      background: transparent;
      color: var(--text-tertiary);
      border: var(--border-thin) solid var(--border);
    }

    /* ============================================
       ESSAY BLOCKS - Scattered positions
       ============================================ */

    .essay {
      max-width: 480px;
      margin-bottom: 12vh;
    }

    .essay p {
      margin: 0 0 var(--space-5) 0;
      text-align: left;
      line-height: 1.8;
    }

    .essay p:first-of-type::first-letter {
      font-size: var(--text-4xl);
      float: left;
      line-height: 0.8;
      padding-right: var(--space-3);
      padding-top: var(--space-1);
      color: var(--accent);
    }

    /* First essay block - right side */
    .essay-1 {
      margin-left: auto;
      margin-right: 8%;
    }

    /* Second essay block - left side, lower */
    .essay-2 {
      margin-left: 12%;
      margin-right: auto;
    }

    /* ============================================
       CODE BLOCK - Centered but tilted
       ============================================ */

    .code-section {
      max-width: 580px;
      margin: 8vh auto 15vh;
      margin-left: 25%;
      background: var(--bg-secondary);
      border: var(--border-thin) solid var(--border);
    }

    .code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-3) var(--space-4);
      border-bottom: var(--border-thin) solid var(--border);
      background: rgba(0, 0, 0, 0.2);
    }

    .code-label {
      font-size: var(--text-xs);
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .code-actions {
      display: flex;
      gap: var(--space-2);
    }

    .code-btn {
      padding: var(--space-1) var(--space-4);
      font-size: var(--text-xs);
      background: transparent;
      border: var(--border-thin) solid var(--text-tertiary);
      color: var(--text-secondary);
      cursor: pointer;
      font-family: var(--font-primary);
      transition: all var(--duration-fast);
    }

    .code-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .code-btn.playing {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--bg-primary);
    }

    .code-content {
      padding: var(--space-5);
      margin: 0;
      overflow-x: auto;
      font-family: var(--font-mono, 'Monaco', 'Consolas', monospace);
      font-size: var(--text-sm);
      line-height: 1.7;
      color: var(--text-primary);
    }

    .code-content code {
      display: block;
      white-space: pre;
    }

    /* Syntax highlighting */
    .code-content .comment { color: var(--text-tertiary); }
    .code-content .function { color: var(--accent); }
    .code-content .string { color: #7ec699; }
    .code-content .number { color: #f08d49; }

    /* ============================================
       REFLECTION - Right side, boxed
       ============================================ */

    .reflection {
      max-width: 420px;
      margin: 10vh 5% 15vh auto;
      padding: var(--space-8);
      background: var(--bg-secondary);
      border-left: 3px solid var(--accent);
    }

    .reflection-header {
      font-size: var(--text-xs);
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-bottom: var(--space-5);
    }

    .reflection p {
      margin: 0 0 var(--space-4) 0;
      font-size: var(--text-sm);
      line-height: 1.9;
    }

    .reflection p:last-child {
      margin-bottom: 0;
    }

    /* ============================================
       FOOTNOTES - Bottom left, small
       ============================================ */

    /* ============================================
       FOOTER - Full width, grounded
       ============================================ */

    .journal-footer {
      position: relative;
      z-index: 10;
      margin-top: 15vh;
      padding: var(--space-8) var(--space-8);
      background: var(--bg-primary);
    }

    .journal-footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: var(--space-8);
      right: var(--space-8);
      height: 1px;
      background: var(--border);
    }

    .footnotes {
      max-width: 720px;
      margin: 0 auto var(--space-8);
      padding: 0 var(--space-4);
      font-size: var(--text-xs);
      color: var(--text-tertiary);
    }

    .footnotes-header {
      font-size: 10px;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.2em;
      margin-bottom: var(--space-4);
    }

    .footnote {
      display: flex;
      gap: var(--space-3);
      margin-bottom: var(--space-3);
      line-height: 1.6;
    }

    .footnote-number {
      color: var(--accent);
      font-size: 10px;
      min-width: 1.5em;
    }

    .footnote-text {
      flex: 1;
    }

    .footnote-text a {
      color: var(--text-tertiary);
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    .footnote-text a:hover {
      color: var(--accent);
    }

    /* Footnote references in text */
    .footnote-ref {
      font-size: var(--text-xs);
      vertical-align: super;
      color: var(--accent);
      text-decoration: none;
      cursor: pointer;
    }

    .footnote-ref:hover {
      text-decoration: underline;
    }

    .journal-nav {
      display: flex;
      justify-content: space-between;
      max-width: 720px;
      margin: 0 auto;
      padding: 0 var(--space-4);
      font-size: var(--text-sm);
    }

    .journal-nav a {
      color: var(--text-tertiary);
      text-decoration: none;
      transition: color var(--duration-fast);
    }

    .journal-nav a:hover {
      color: var(--accent);
    }

    /* ============================================
       PLAYING STATE - Solid backgrounds when vis active
       ============================================ */

    /* Hide Hydra by default */
    hydra-canvas {
      opacity: 0;
      transition: opacity var(--duration-slow, 500ms) ease;
    }

    /* Show Hydra when playing */
    body.playing hydra-canvas {
      opacity: 1;
    }

    /* Text areas get solid backgrounds + borders when playing */
    body.playing .journal-header {
      background: var(--bg-primary);
      padding: var(--space-6);
      border: var(--border-thin) solid var(--border);
      margin-bottom: 12vh;
    }

    body.playing .essay {
      background: var(--bg-primary);
      padding: var(--space-6);
      border: var(--border-thin) solid var(--border);
    }

    body.playing .code-section {
      border-width: 2px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    body.playing .reflection {
      border: var(--border-thin) solid var(--border);
      border-left: 3px solid var(--accent);
    }

    body.playing .journal-footer {
      /* Footer already has solid background, just ensure it's visible */
    }

    body.playing .journal-footer::before {
      height: 2px;
    }

    /* ============================================
       PLAYBACK CONTROLS
       ============================================ */

    .playback-controls {
      position: fixed;
      bottom: var(--space-6);
      right: var(--space-6);
      z-index: 100;
      display: flex;
      gap: var(--space-2);
      padding: var(--space-3);
      background: rgba(var(--bg-primary-rgb, 26, 26, 26), 0.9);
      border: var(--border-thin) solid var(--border);
      backdrop-filter: blur(10px);
    }

    .playback-btn {
      width: 40px;
      height: 40px;
      border: var(--border-thin) solid var(--text-primary);
      background: transparent;
      color: var(--text-primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--duration-fast);
    }

    .playback-btn:hover {
      background: var(--text-primary);
      color: var(--bg-primary);
    }

    .playback-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .playback-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--bg-primary);
    }

    .volume-control {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: 0 var(--space-2);
    }

    .volume-control input {
      width: 60px;
    }

    .preset-selector {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding-left: var(--space-3);
      border-left: var(--border-thin) solid var(--border);
      margin-left: var(--space-2);
    }

    .preset-selector select {
      background: var(--bg-secondary);
      border: var(--border-thin) solid var(--border);
      color: var(--text-primary);
      padding: var(--space-1) var(--space-2);
      font-size: var(--text-xs);
      font-family: var(--font-primary);
    }

    /* ============================================
       RESPONSIVE - Stack on mobile
       ============================================ */

    @media (max-width: 900px) {
      .journal-page {
        padding: var(--space-6);
      }

      .journal-header,
      .essay,
      .code-section,
      .reflection {
        max-width: 100%;
        margin-left: 0;
        margin-right: 0;
      }

      .essay-1,
      .essay-2 {
        margin-left: 0;
        margin-right: 0;
      }

      .journal-footer {
        padding: var(--space-6) var(--space-4);
      }

      .journal-footer::before {
        left: var(--space-4);
        right: var(--space-4);
      }

      .playback-controls {
        bottom: var(--space-4);
        right: var(--space-4);
        left: var(--space-4);
        justify-content: center;
      }

      .preset-selector {
        display: none;
      }
    }

    /* ============================================
       REDUCED MOTION
       ============================================ */

    @media (prefers-reduced-motion: reduce) {
      .reduced-motion-notice {
        display: block;
        position: fixed;
        top: var(--space-4);
        left: 50%;
        transform: translateX(-50%);
        background: var(--bg-secondary);
        padding: var(--space-2) var(--space-4);
        font-size: var(--text-xs);
        color: var(--text-secondary);
        z-index: 100;
        border: var(--border-thin) solid var(--border);
      }
    }

    .reduced-motion-notice {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Hydra canvas (renders behind content) -->
  <hydra-canvas id="hydra" auto-connect preset="minimal"></hydra-canvas>

  <article class="journal-page">
    <div class="reduced-motion-notice">
      Reduced motion is enabled. Background visuals are simplified.
    </div>

    <header class="journal-header">
      <div class="journal-date">January 29, 2026 — Session #48</div>
      <h1 class="journal-title">
        <glitch-text text="Listening While Playing"></glitch-text>
      </h1>
      <p class="journal-subtitle">On the feedback loop between ear and fingers</p>
      <div class="journal-tags">
        <span class="tag">blues</span>
        <span class="tag">practice</span>
        <span class="tag">listening</span>
        <span class="tag">guitar</span>
      </div>
    </header>

    <section class="essay essay-1">
      <p>
        There's a particular kind of listening that only happens when you're playing. Not the
        analytical listening of studying a record, not the passive listening of background music,
        but something more immediate—a feedback loop where what you hear shapes what you play,
        and what you play changes what you hear. Vijay Iyer calls this "embodied cognition,"<a href="#fn1" class="footnote-ref">1</a>
        the idea that musical understanding lives in the body as much as the mind.
      </p>

      <p>
        Tonight I wanted to practice this loop explicitly. I built a simple A minor blues backing
        track—shuffle drums, arpeggiated chords—and tried to really <em>listen</em> to it while
        playing over it. Not just keeping time, but hearing where the chord tones land, feeling
        the pull of the dominant chord, noticing how the shuffle creates space between the beats.
      </p>

      <p>
        The pattern below outlines the changes: Am for four bars, Dm for two, back to Am, then
        the E7 that wants to resolve. The arpeggios are sparse on purpose—they leave room for
        the guitar to fill in, to respond, to have a conversation.
      </p>
    </section>

    <div class="code-section">
      <div class="code-header">
        <span class="code-label">Strudel Pattern</span>
        <div class="code-actions">
          <button class="code-btn" id="play-pattern">Play</button>
          <button class="code-btn" id="stop-pattern" disabled>Stop</button>
        </div>
      </div>
      <pre class="code-content"><code><span class="comment">// A minor blues - shuffle feel</span>
<span class="function">stack</span>(
  <span class="comment">// drums: shuffle groove</span>
  <span class="function">s</span>(<span class="string">"bd ~ ~ bd:1 ~ bd ~ ~"</span>),
  <span class="function">s</span>(<span class="string">"~ ~ sd ~ ~ ~ sd ~"</span>).<span class="function">gain</span>(<span class="number">.8</span>),
  <span class="function">s</span>(<span class="string">"hh*8"</span>).<span class="function">gain</span>(<span class="string">".5 .3 .6 .3 .5 .3 .6 .3"</span>),

  <span class="comment">// arpeggios: Am-Am-Am-Am | Dm-Dm | Am-Am | E7-Dm | Am-Am</span>
  <span class="function">note</span>(<span class="string">"&lt;[a2 e3 a3] [a2 c3 e3] [a2 e3 a3] [a2 c3 e3]</span>
        <span class="string"> [d2 a2 d3] [d2 f3 a3]</span>
        <span class="string"> [a2 e3 a3] [a2 c3 e3]</span>
        <span class="string"> [e2 gs2 b2 d3] [d2 f3 a3]</span>
        <span class="string"> [a2 e3 a3] [a2 c3 e3]&gt;"</span>)
    .<span class="function">s</span>(<span class="string">"triangle"</span>)
    .<span class="function">decay</span>(<span class="number">.4</span>).<span class="function">sustain</span>(<span class="number">.1</span>)
    .<span class="function">gain</span>(<span class="number">.35</span>)
).<span class="function">slow</span>(<span class="number">4</span>).<span class="function">cpm</span>(<span class="number">45</span>)</code></pre>
    </div>

    <section class="essay essay-2">
      <p>
        The hardest part isn't playing the right notes—it's listening while you play. Kenny
        Werner writes about this in <em>Effortless Mastery</em>:<a href="#fn2" class="footnote-ref">2</a>
        the goal is to play from a place of stillness, where the hands move but the mind stays
        quiet enough to hear. Most of my practice, I realize, is the opposite. I'm so focused
        on what I'm doing that I stop hearing what's happening.
      </p>

      <p>
        The visual feedback helps, surprisingly. When the kick hits and the screen pulses, it
        gives my eyes something to track so my ears can relax. The arpeggios become visible—I
        can see the chord change coming before I hear it. This might be a crutch, but for now
        it's helping me sync up.
      </p>
    </section>

    <section class="reflection">
      <div class="reflection-header">Reflection</div>
      <p>
        Something clicked tonight around the E7 chord. That's the V in A minor—the tension point,
        the moment that wants to resolve. When I actually <em>heard</em> it coming, my fingers
        knew what to do. Not because I thought "E7, play G#," but because the sound pulled me
        there. This is what people mean by "playing the changes," I think.
      </p>
      <p>
        Derek Bailey talks about improvisation as "the celebration of the moment."<a href="#fn3" class="footnote-ref">3</a>
        But you can't celebrate a moment you're not present for. The backing track forces presence—
        it keeps moving whether I'm ready or not. There's no pausing to think. Either I'm
        listening and responding, or I'm just making noise over someone else's music.
      </p>
      <p>
        Next session I want to try singing the chord tones before playing them. If I can hear
        them in my head first, maybe my hands will follow more naturally.
      </p>
    </section>

  </article>

  <footer class="journal-footer">
    <div class="footnotes">
      <div class="footnotes-header">References</div>

      <div class="footnote" id="fn1">
        <span class="footnote-number">1.</span>
        <span class="footnote-text">
          Iyer, Vijay. "Embodied Mind, Situated Cognition, and Expressive Microtiming in
          African-American Music." <em>Music Perception</em>, vol. 19, no. 3, 2002, pp. 387-414.
        </span>
      </div>

      <div class="footnote" id="fn2">
        <span class="footnote-number">2.</span>
        <span class="footnote-text">
          Werner, Kenny. <em>Effortless Mastery: Liberating the Master Musician Within</em>.
          Jamey Aebersold Jazz, 1996. Chapter 4: "The Space."
        </span>
      </div>

      <div class="footnote" id="fn3">
        <span class="footnote-number">3.</span>
        <span class="footnote-text">
          Bailey, Derek. <em>Improvisation: Its Nature and Practice in Music</em>.
          Da Capo Press, 1993. p. 142.
        </span>
      </div>
    </div>

    <nav class="journal-nav">
      <a href="#">← Previous: "First Steps with TidalCycles"</a>
      <a href="#">Next: "Bass and Space" →</a>
    </nav>
  </footer>

  <!-- Playback controls -->
  <div class="playback-controls">
    <button class="playback-btn" id="global-play" title="Play">▶</button>
    <button class="playback-btn" id="global-stop" title="Stop" disabled>■</button>
    <div class="volume-control">
      <span style="font-size: var(--text-xs);">Vol</span>
      <input type="range" id="volume" min="0" max="100" value="30">
    </div>
    <div class="preset-selector">
      <select id="hydra-preset">
        <option value="minimal">Minimal</option>
        <option value="reactive">Reactive</option>
        <option value="feedback">Feedback</option>
        <option value="noise">Noise</option>
        <option value="geometric">Geometric</option>
        <option value="psychedelic">Psychedelic</option>
      </select>
    </div>
  </div>

  <!-- Load components and demo script -->
  <script type="module" src="/src/journal-entry-demo.ts"></script>
</body>
</html>
